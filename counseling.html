<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>진로 ?�담 - JJOBB</title>
    <link rel="icon" type="image/png" href="images/favicon.png">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/counseling.css">
</head>
<body>
    <header id="mainHeader">
        <nav>
            <div class="logo">
                <img src="images/logo.png" alt="JJOBB" style="height: 40px;">
            </div>
            <ul class="nav-links">
                <li><a href="dashboard.html">?�?�보??/a></li>
                <li><a href="jobs.html">채용 ?�보</a></li>
                <li><a href="networking.html">?�문 ?�트?�킹</a></li>
                <li><a href="counseling.html" class="active">진로 ?�담</a></li>
            </ul>
            <div class="user-menu">
                <span class="user-name" id="userName"></span>
                <button onclick="auth.logout()" class="btn-logout">로그?�웃</button>
            </div>
        </nav>
    </header>

    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="sidebar-menu">
                <a href="dashboard.html" class="menu-item">
                    <span class="icon">?��</span>
                    <span>?�?�보??/span>
                </a>
                <a href="profile.html" class="menu-item">
                    <span class="icon">?��</span>
                    <span>???�로??/span>
                </a>
                <a href="jobs.html" class="menu-item">
                    <span class="icon">?��</span>
                    <span>채용 ?�보</span>
                </a>
                <a href="networking.html" class="menu-item">
                    <span class="icon">?��</span>
                    <span>?�문 ?�트?�킹</span>
                </a>
                <a href="counseling.html" class="menu-item active" id="counselingMenu">
                    <span class="icon">?��</span>
                    <span>진로 ?�담</span>
                </a>
                <a href="career.html" class="menu-item" id="careerMenu">
                    <span class="icon">?��</span>
                    <span>경력 관�?/span>
                </a>
            </div>
        </aside>

        <main class="main-content">
            <div class="page-header">
                <h1>?�� 진로 ?�담 ?�비??/h1>
                <p id="pageSubtitle">?�문 ?�담교사?� 1:1 ?�담???�해 진로�??�계?�세??/p>
            </div>

            <!-- ?�생????메뉴 -->
            <div class="counseling-tabs" id="studentTabs">
                <button class="tab-btn active" data-tab="apply">?�담 ?�청</button>
                <button class="tab-btn" data-tab="my">???�담</button>
                <button class="tab-btn" data-tab="message">메시지</button>
                <button class="tab-btn" data-tab="teachers">?�담교사</button>
            </div>

            <!-- ?�생?�용 ??메뉴 -->
            <div class="counseling-tabs" id="teacherTabs" style="display: none;">
                <button class="tab-btn active" data-tab="requests">?�담 ?�청 ?�역</button>
                <button class="tab-btn" data-tab="schedule">???�정</button>
                <button class="tab-btn" data-tab="message">메시지</button>
            </div>

            <!-- ?�생?�용: ?�담 ?�청 ?�역 ??-->
            <div class="tab-content" id="requests-tab" style="display: none;">
                <div class="content-section">
                    <h2>?�� ?�생 ?�담 ?�청 ?�역</h2>
                    <div id="counselingRequestsList">
                        <p style="text-align: center; color: #6b7280; padding: 2rem;">?�담 ?�청 ?�역???�습?�다.</p>
                    </div>
                </div>
            </div>

            <!-- ?�생?�용: ???�정 ??-->
            <div class="tab-content" id="schedule-tab" style="display: none;">
                <div class="content-section">
                    <h2>?�� ???�담 ?�정</h2>
                    <div id="scheduleList" class="schedule-list">
                        <p style="text-align: center; color: #6b7280; padding: 2rem;">?�정???�담???�습?�다.</p>
                    </div>
                </div>
            </div>

            <!-- ?�담 ?�청 ??-->
            <div class="tab-content active" id="apply-tab">
                <div class="counseling-form-container">
                    <h2>+ ???�담 ?�청</h2>
                    <p class="form-subtitle">?�문 ?�담교사?�게 1:1 ?�담???�해 진로�??�계?�세??/p>

                    <form id="counselingForm" class="counseling-form">
                        <div class="form-row-grid">
                            <div class="form-group">
                                <label>?�담 ?�형</label>
                                <select id="counselingType" required>
                                    <option value="진로 ?�담">진로 ?�담</option>
                                    <option value="취업 ?�담">취업 ?�담</option>
                                    <option value="?�업 ?�담">?�업 ?�담</option>
                                    <option value="진학 ?�담">진학 ?�담</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>?�담교사 ?�택</label>
                                <select id="counselor" required>
                                    <option value="">?�담교사�??�택?�세??/option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>?�담 ?�목</label>
                            <input type="text" id="counselingTitle" placeholder="?�담 ?�목???�력?�세?? required>
                        </div>

                        <div class="form-group">
                            <label>?�담 ?�용</label>
                            <textarea id="counselingContent" rows="5" placeholder="?�담받고 ?��? ?�용???�세???�성?�주?�요" required></textarea>
                        </div>

                        <div class="form-row-grid">
                            <div class="form-group">
                                <label>?�망 ?�짜</label>
                                <input type="date" id="counselingDate" required>
                            </div>

                            <div class="form-group">
                                <label>?�망 ?�간</label>
                                <select id="counselingTime" required>
                                    <option value="09:00">09:00</option>
                                    <option value="10:00">10:00</option>
                                    <option value="11:00">11:00</option>
                                    <option value="13:00">13:00</option>
                                    <option value="14:00" selected>14:00</option>
                                    <option value="15:00">15:00</option>
                                    <option value="16:00">16:00</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>?�담 방식</label>
                            <select id="counselingMethod" required>
                                <option value="?�상?�담">?�상?�담</option>
                                <option value="?�면상??>?�면상??/option>
                                <option value="?�화?�담">?�화?�담</option>
                            </select>
                        </div>

                        <button type="submit" class="btn-submit">?�담 ?�청?�기</button>
                    </form>
                </div>
            </div>

            <!-- ???�담 ??-->
            <div class="tab-content" id="my-tab">
                <div class="counseling-list">
                    <h2>???�담 ?�역</h2>
                    <div id="myCounselingList">
                        <p style="text-align: center; color: #6b7280; padding: 2rem;">?�청???�담???�습?�다.</p>
                    </div>
                </div>
            </div>

            <!-- 메시지 ??-->
            <div class="tab-content" id="message-tab">
                <div class="message-container">
                    <h2>?�담 메시지</h2>
                    <p class="empty-state">메시지가 ?�습?�다.</p>
                </div>
            </div>

            <!-- ?�담교사 ??-->
            <div class="tab-content" id="teachers-tab">
                <div class="teachers-grid">
                    <h2>?�담교사 ?�개</h2>
                    <div id="teachersListContainer">
                        <p style="text-align: center; color: #6b7280; padding: 2rem;">?�록???�담교사가 ?�습?�다.</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/counseling.js"></script>
    <script>
        // ?�용???�인 �?UI 초기??
        const currentUser = auth.getCurrentUser();
        const isTeacher = currentUser && currentUser.user_type === 'teacher';

        // ?�생?�인 경우 UI 변�?
        if (isTeacher) {
            document.getElementById('pageSubtitle').textContent = '?�생?�의 ?�담 ?�청???�인?�고 관리하?�요';
            
            // ?�생????�� 컨텐�??�기�?
            document.getElementById('studentTabs').style.display = 'none';
            document.getElementById('apply-tab').classList.remove('active');
            document.getElementById('apply-tab').style.display = 'none';
            document.getElementById('my-tab').style.display = 'none';
            document.getElementById('teachers-tab').style.display = 'none';
            
            // ?�생?�용 ??�� 컨텐�??�시
            document.getElementById('teacherTabs').style.display = 'flex';
            document.getElementById('requests-tab').style.display = 'block';
            document.getElementById('requests-tab').classList.add('active');
            
            // ?�담 ?�청 ?�역 로드
            loadCounselingRequests();
            
            // ???�정 로드
            loadMySchedule();
        } else {
            // ?�생??경우 ?�생?�용 ?�기�?
            document.getElementById('teacherTabs').style.display = 'none';
            document.getElementById('requests-tab').style.display = 'none';
            document.getElementById('schedule-tab').style.display = 'none';
        }

        // ?�생?�용: ???�정 로드
        function loadMySchedule() {
            const scheduleList = document.getElementById('scheduleList');
            if (!scheduleList) return;
            
            let counselingRequests = JSON.parse(localStorage.getItem('counselingRequests') || '[]');
            
            // ?�재 ?�생?�의 ?�인/거절???�담�??�터�?
            const mySchedules = counselingRequests.filter(req => 
                req.teacherId === currentUser.id && (req.status === 'approved' || req.status === 'rejected')
            );
            
            if (mySchedules.length === 0) {
                scheduleList.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 2rem;">처리???�담 ?�역???�습?�다.</p>';
                return;
            }
            
            const statusMap = {
                'approved': { text: '?�인??, color: '#d1fae5', textColor: '#065f46', icon: '?? },
                'rejected': { text: '거절??, color: '#fee2e2', textColor: '#991b1b', icon: '?? }
            };
            
            scheduleList.innerHTML = mySchedules.map(req => {
                const status = statusMap[req.status];
                return `
                    <div class="schedule-card" style="background: white; padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-left: 4px solid ${req.status === 'approved' ? '#10b981' : '#ef4444'};">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <div>
                                <h3 style="margin: 0 0 0.5rem 0; color: var(--primary-color);">${req.title}</h3>
                                <p style="margin: 0; color: #6b7280;">?�생: ${req.studentName} | ?�형: ${req.type}</p>
                            </div>
                            <span style="padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.85rem; background: ${status.color}; color: ${status.textColor}; font-weight: 600;">
                                ${status.icon} ${status.text}
                            </span>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: #f9fafb; border-radius: 4px;">
                            <div>
                                <label style="font-size: 0.85rem; color: #6b7280;">?�짜</label>
                                <p style="margin: 0.25rem 0 0 0; font-weight: 600;">${req.date}</p>
                            </div>
                            <div>
                                <label style="font-size: 0.85rem; color: #6b7280;">?�간</label>
                                <p style="margin: 0.25rem 0 0 0; font-weight: 600;">${req.time}</p>
                            </div>
                            <div>
                                <label style="font-size: 0.85rem; color: #6b7280;">방법</label>
                                <p style="margin: 0.25rem 0 0 0; font-weight: 600;">${req.method}</p>
                            </div>
                        </div>
                        ${req.status === 'rejected' ? `
                            <div style="padding: 1rem; background: #fee2e2; border-radius: 4px;">
                                <p style="margin: 0; font-weight: 600; color: #991b1b; margin-bottom: 0.5rem;">거절 ?�유</p>
                                <p style="margin: 0; color: #7f1d1d;">${req.rejectReason}</p>
                            </div>
                        ` : ''}
                        ${req.status === 'approved' ? `
                            <div style="padding: 1rem; background: #d1fae5; border-radius: 4px;">
                                <p style="margin: 0; color: #065f46;">
                                    <strong>???�인??/strong> - ?�정???�담?�니?? ?�생???�정?�도 ?�시?�니??
                                </p>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        // ?�생?�용: ?�담 ?�청 ?�역 로드
        function loadCounselingRequests() {
            const requestsList = document.getElementById('counselingRequestsList');
            
            // localStorage?�서 ?�담 ?�청 ?�이??가?�오�?
            let counselingRequests = JSON.parse(localStorage.getItem('counselingRequests') || '[]');
            
            // 초기 ?�플 ?�이???�성 ?�함 - ?�제 ?�청�??�시
            // (?�플 ?�이?��? ?�요?�면 브라?��? 콘솔?�서 직접 추�?)
            
            // ?�재 ?�생?�에�????�기중???�청�??�터�?
            const myRequests = counselingRequests.filter(req => 
                req.teacherId === currentUser.id && req.status === 'pending'
            );

            if (myRequests.length === 0) {
                requestsList.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 2rem;">?�담 ?�청 ?�역???�습?�다.</p>';
                return;
            }

            requestsList.innerHTML = myRequests.map(req => `
                <div class="counseling-request-card" style="background: white; padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                        <div>
                            <h3 style="margin: 0 0 0.5rem 0; color: var(--primary-color);">${req.title}</h3>
                            <p style="margin: 0; color: #6b7280;">?�청?? ${req.studentName} | ?�형: ${req.type}</p>
                        </div>
                        <span class="status-badge" style="padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.85rem; background: #fef3c7; color: #92400e;">?�기중</span>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: #f9fafb; border-radius: 4px;">
                        <div>
                            <label style="font-size: 0.85rem; color: #6b7280;">?�담 ?�짜</label>
                            <p style="margin: 0.25rem 0 0 0; font-weight: 600;">${req.date}</p>
                        </div>
                        <div>
                            <label style="font-size: 0.85rem; color: #6b7280;">?�담 ?�간</label>
                            <p style="margin: 0.25rem 0 0 0; font-weight: 600;">${req.time}</p>
                        </div>
                        <div>
                            <label style="font-size: 0.85rem; color: #6b7280;">?�담 방법</label>
                            <p style="margin: 0.25rem 0 0 0; font-weight: 600;">${req.method}</p>
                        </div>
                    </div>
                    <div style="display: flex; gap: 0.5rem; justify-content: flex-end;">
                        <button class="btn btn-secondary" onclick="viewRequestDetail(${req.id})" style="padding: 0.5rem 1rem;">?�세보기</button>
                        <button class="btn btn-primary" onclick="approveRequest(${req.id})" style="padding: 0.5rem 1rem;">?�인</button>
                        <button class="btn" onclick="rejectRequest(${req.id})" style="padding: 0.5rem 1rem; background: #ef4444; color: white;">거절</button>
                    </div>
                </div>
            `).join('');
        }

        function viewRequestDetail(id) {
            alert('?�담 ?�청 ?�세보기 (ID: ' + id + ')');
        }

        function approveRequest(id) {
            if (confirm('???�담 ?�청???�인?�시겠습?�까?')) {
                let counselingRequests = JSON.parse(localStorage.getItem('counselingRequests') || '[]');
                const requestIndex = counselingRequests.findIndex(req => req.id === id);
                
                if (requestIndex !== -1) {
                    counselingRequests[requestIndex].status = 'approved';
                    counselingRequests[requestIndex].approvedAt = new Date().toISOString();
                    localStorage.setItem('counselingRequests', JSON.stringify(counselingRequests));
                    
                    alert('?�담???�인?�었?�니?? ?�생???�정???�동?�로 추�??�니??');
                    loadCounselingRequests();
                    loadMySchedule(); // ???�정???�데?�트
                }
            }
        }

        function rejectRequest(id) {
            const reason = prompt('거절 ?�유�??�력?�주?�요:');
            
            if (reason === null) {
                return; // 취소
            }
            
            if (reason.trim() === '') {
                alert('거절 ?�유�??�력?�주?�요.');
                return;
            }
            
            let counselingRequests = JSON.parse(localStorage.getItem('counselingRequests') || '[]');
            const requestIndex = counselingRequests.findIndex(req => req.id === id);
            
            if (requestIndex !== -1) {
                counselingRequests[requestIndex].status = 'rejected';
                counselingRequests[requestIndex].rejectedAt = new Date().toISOString();
                counselingRequests[requestIndex].rejectReason = reason;
                localStorage.setItem('counselingRequests', JSON.stringify(counselingRequests));
                
                alert('?�담??거절?�었?�니??');
                loadCounselingRequests();
                loadMySchedule(); // ???�정???�데?�트
            }
        }

        // ???�환 기능
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const parentTabs = btn.closest('.counseling-tabs');
                parentTabs.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                btn.classList.add('active');
                const tabName = btn.getAttribute('data-tab');
                const targetTab = document.getElementById(tabName + '-tab');
                if (targetTab) {
                    targetTab.classList.add('active');
                }
            });
        });

        // ?�담교사 목록 로드
        function loadTeachersList() {
            const counselorSelect = document.getElementById('counselor');
            if (!counselorSelect) return;
            
            const users = JSON.parse(localStorage.getItem('graduateNetwork_users') || '[]');
            const teachers = users.filter(u => u.user_type === 'teacher');
            
            // 기존 ?�션 ?��??�고 teacher 추�?
            counselorSelect.innerHTML = '<option value="">?�담교사�??�택?�세??/option>';
            
            if (teachers.length === 0) {
                counselorSelect.innerHTML += '<option value="" disabled>?�록???�생?�이 ?�습?�다</option>';
            } else {
                teachers.forEach(teacher => {
                    const option = document.createElement('option');
                    option.value = teacher.id; // teacher ID�?값으�??�용
                    option.textContent = `${teacher.name} (${teacher.email})`;
                    option.dataset.teacherName = teacher.name; // ?�름 ?�??
                    counselorSelect.appendChild(option);
                });
            }
        }

        // ?�담교사 ?�로???�시
        function loadTeachersProfile() {
            const container = document.getElementById('teachersListContainer');
            if (!container) return;
            
            const users = JSON.parse(localStorage.getItem('graduateNetwork_users') || '[]');
            const teachers = users.filter(u => u.user_type === 'teacher');
            
            if (teachers.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 2rem;">?�록???�담교사가 ?�습?�다.</p>';
                return;
            }
            
            container.innerHTML = teachers.map(teacher => `
                <div class="teacher-card" style="background: white; border-radius: 12px; padding: 2rem; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <div class="teacher-avatar" style="font-size: 4rem; margin-bottom: 1rem;">?��?��?/div>
                    <h3 style="margin: 0 0 0.5rem 0; color: var(--primary-color);">${teacher.name}</h3>
                    <p style="margin: 0 0 0.5rem 0; color: #6b7280; font-size: 0.9rem;">${teacher.email}</p>
                    <p style="margin: 0 0 1rem 0; color: #4b5563;">${teacher.schoolName || '?�주공업고등?�교'}</p>
                    <div style="padding: 1rem; background: #f3f4f6; border-radius: 8px; margin-top: 1rem;">
                        <p style="margin: 0; font-size: 0.9rem; color: #374151;">
                            <strong>?�락�?</strong> ${teacher.phone || '?�보 ?�음'}
                        </p>
                    </div>
                    <button onclick="contactTeacher(${teacher.id})" class="btn btn-primary" style="margin-top: 1rem; width: 100%;">
                        ?�담 ?�청?�기
                    </button>
                </div>
            `).join('');
        }

        function contactTeacher(teacherId) {
            // ?�담 ?�청 ??���??�동?�고 ?�당 ?�생???�동 ?�택
            const applyTab = document.querySelector('.tab-btn[data-tab="apply"]');
            if (applyTab) {
                applyTab.click();
                setTimeout(() => {
                    const counselorSelect = document.getElementById('counselor');
                    if (counselorSelect) {
                        counselorSelect.value = teacherId;
                        counselorSelect.focus();
                    }
                }, 100);
            }
        }

        // ?�생?? ???�담 ?�역 로드
        function loadMyCounseling() {
            const myList = document.getElementById('myCounselingList');
            if (!myList) return;
            
            let counselingRequests = JSON.parse(localStorage.getItem('counselingRequests') || '[]');
            const myRequests = counselingRequests.filter(req => req.studentId === currentUser.id);
            
            if (myRequests.length === 0) {
                myList.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 2rem;">?�청???�담???�습?�다.</p>';
                return;
            }
            
            const statusMap = {
                'pending': { text: '?�기중', color: '#fef3c7', textColor: '#92400e' },
                'approved': { text: '?�인??, color: '#d1fae5', textColor: '#065f46' },
                'rejected': { text: '거절??, color: '#fee2e2', textColor: '#991b1b' }
            };
            
            myList.innerHTML = myRequests.map(req => {
                const status = statusMap[req.status] || statusMap['pending'];
                return `
                    <div class="counseling-card" style="background: white; padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <div>
                                <h3 style="margin: 0 0 0.5rem 0; color: var(--primary-color);">${req.title}</h3>
                                <p style="margin: 0; color: #6b7280;">?�담교사: ${req.teacherName} | ?�형: ${req.type}</p>
                            </div>
                            <span style="padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.85rem; background: ${status.color}; color: ${status.textColor};">${status.text}</span>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; padding: 1rem; background: #f9fafb; border-radius: 4px;">
                            <div>
                                <label style="font-size: 0.85rem; color: #6b7280;">?�짜</label>
                                <p style="margin: 0.25rem 0 0 0; font-weight: 600;">${req.date}</p>
                            </div>
                            <div>
                                <label style="font-size: 0.85rem; color: #6b7280;">?�간</label>
                                <p style="margin: 0.25rem 0 0 0; font-weight: 600;">${req.time}</p>
                            </div>
                            <div>
                                <label style="font-size: 0.85rem; color: #6b7280;">방법</label>
                                <p style="margin: 0.25rem 0 0 0; font-weight: 600;">${req.method}</p>
                            </div>
                        </div>
                        ${req.status === 'rejected' ? `
                            <div style="margin-top: 1rem; padding: 1rem; background: #fee2e2; border-radius: 4px; border-left: 4px solid #dc2626;">
                                <p style="margin: 0; font-weight: 600; color: #991b1b; margin-bottom: 0.5rem;">거절 ?�유</p>
                                <p style="margin: 0; color: #7f1d1d;">${req.rejectReason}</p>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        // ?�생?????�출
        const counselingForm = document.getElementById('counselingForm');
        if (counselingForm && !isTeacher) {
            // ?�담교사 목록 로드
            loadTeachersList();
            
            // ???�담 ?�역 로드
            loadMyCounseling();
            
            counselingForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                // ?�생???�보 찾기
                const counselorSelect = document.getElementById('counselor');
                const teacherId = parseInt(counselorSelect.value);
                const selectedOption = counselorSelect.options[counselorSelect.selectedIndex];
                const teacherName = selectedOption.dataset.teacherName || selectedOption.text;
                
                const newRequest = {
                    id: Date.now(),
                    studentId: currentUser.id,
                    studentName: currentUser.name,
                    teacherId: teacherId,
                    teacherName: teacherName,
                    type: document.getElementById('counselingType').value,
                    title: document.getElementById('counselingTitle').value,
                    content: document.getElementById('counselingContent').value,
                    date: document.getElementById('counselingDate').value,
                    time: document.getElementById('counselingTime').value,
                    method: document.getElementById('counselingMethod').value,
                    status: 'pending',
                    createdAt: new Date().toISOString()
                };
                
                let counselingRequests = JSON.parse(localStorage.getItem('counselingRequests') || '[]');
                counselingRequests.push(newRequest);
                localStorage.setItem('counselingRequests', JSON.stringify(counselingRequests));

                alert('?�담 ?�청???�료?�었?�니??');
                e.target.reset();
                
                // ???�담 ?�역 ?�로고침
                loadMyCounseling();
            });
        }

        // ?�용???�름 ?�시
        if (currentUser) {
            document.getElementById('userName').textContent = currentUser.name;
        }

        // ???�환 기능
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const parentTabs = btn.closest('.counseling-tabs');
                parentTabs.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                btn.classList.add('active');
                const tabName = btn.getAttribute('data-tab');
                const targetTab = document.getElementById(tabName + '-tab');
                if (targetTab) {
                    targetTab.classList.add('active');
                    
                    // ???�정 ???�릭 ???�이??로드
                    if (tabName === 'schedule' && isTeacher) {
                        loadMySchedule();
                    }
                    // ???�담 ???�릭 ???�이??로드 (?�생)
                    if (tabName === 'my' && !isTeacher) {
                        loadMyCounseling();
                    }
                    // ?�담교사 ???�릭 ???�로??로드 (?�생)
                    if (tabName === 'teachers' && !isTeacher) {
                        loadTeachersProfile();
                    }
                }
            });
        });

        // ?�늘 ?�짜�?최소 ?�짜�??�정
        const dateInput = document.getElementById('counselingDate');
        if (dateInput) {
            const today = new Date().toISOString().split('T')[0];
            dateInput.setAttribute('min', today);
        }
    </script>
</body>
</html>
