<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì·¨ì—… ë°•ëŒíšŒ - ì¡¸ì—…ìƒ ë„¤íŠ¸ì›Œí¬</title>
    <link rel="icon" type="image/png" href="images/favicon.png">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/announcements.css">
    <link rel="stylesheet" href="css/dashboard.css">
</head>
<body>
    <header id="mainHeader">
        <nav>
            <div class="logo">
                <img src="images/logo.png" alt="JJOBB" style="height: 40px;">
            </div>
            <ul class="nav-links">
                <li><a href="index.html">í™ˆ</a></li>
                <li><a href="jobs.html">ì±„ìš©ì •ë³´</a></li>
                <li><a href="networking.html">ë„¤íŠ¸ì›Œí‚¹</a></li>
                <li><a href="counseling.html">ì§„ë¡œìƒë‹´</a></li>
                <li><a href="job-fair.html" class="active">ì·¨ì—…ë°•ëŒíšŒ</a></li>
                <li><a href="industry-visit.html">ì‚°ì—…ì²´ ê²¬í•™</a></li>
                <li><a href="certification-support.html">ìê²©ì¦ ì§€ì›</a></li>
            </ul>
            <div class="auth-buttons" id="authButtons">
                <a href="login.html" class="btn-login">ë¡œê·¸ì¸</a>
                <a href="register.html" class="btn-register">íšŒì›ê°€ì…</a>
            </div>
            <div class="user-menu" id="userMenu" style="display: none;">
                <span class="user-name" id="userName"></span>
                <button onclick="auth.logout()" class="btn-logout">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </nav>
    </header>

    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="sidebar-menu">
                <a href="index.html" class="menu-item">
                    <span class="icon">ğŸ </span>
                    <span>í™ˆ</span>
                </a>
                <a href="dashboard.html" class="menu-item">
                    <span class="icon">ğŸ“Š</span>
                    <span>ëŒ€ì‹œë³´ë“œ</span>
                </a>
                <a href="profile.html" class="menu-item">
                    <span class="icon">ğŸ‘¤</span>
                    <span>ë‚´ í”„ë¡œí•„</span>
                </a>
                <a href="jobs.html" class="menu-item">
                    <span class="icon">ğŸ’¼</span>
                    <span>ì±„ìš© ì •ë³´</span>
                </a>
                <a href="networking.html" class="menu-item">
                    <span class="icon">ğŸ¤</span>
                    <span>ë™ë¬¸ ë„¤íŠ¸ì›Œí‚¹</span>
                </a>
                <a href="counseling.html" class="menu-item" id="counselingMenu">
                    <span class="icon">ğŸ’¬</span>
                    <span>ì§„ë¡œ ìƒë‹´</span>
                </a>
                <a href="career.html" class="menu-item" id="careerMenu">
                    <span class="icon">ğŸ“ˆ</span>
                    <span>ê²½ë ¥ ê´€ë¦¬</span>
                </a>
                <a href="education-programs.html" class="menu-item">
                    <span class="icon">ğŸ“</span>
                    <span>êµìœ¡ í”„ë¡œê·¸ë¨</span>
                </a>
                <div style="border-top: 1px solid #e5e7eb; margin: 1rem 0; padding-top: 1rem;">
                    <p style="padding: 0 1rem; color: #6b7280; font-size: 0.875rem; font-weight: 600;">ê³µì§€ì‚¬í•­</p>
                </div>
                <a href="job-fair.html" class="menu-item active">
                    <span class="icon">ğŸ¢</span>
                    <span>ì·¨ì—… ë°•ëŒíšŒ</span>
                </a>
                <a href="industry-visit.html" class="menu-item">
                    <span class="icon">ğŸ­</span>
                    <span>ì‚°ì—…ì²´ ê²¬í•™</span>
                </a>
                <a href="certification-support.html" class="menu-item">
                    <span class="icon">ğŸ“œ</span>
                    <span>ìê²©ì¦ ì§€ì›</span>
                </a>
                <!-- ê´€ë¦¬ì ë©”ë‰´ -->
                <div id="adminMenuSection" style="display: none;">
                    <div style="border-top: 1px solid #e5e7eb; margin: 1rem 0; padding-top: 1rem;">
                        <p style="padding: 0 1rem; color: #6b7280; font-size: 0.875rem; font-weight: 600;">ê´€ë¦¬ì ë©”ë‰´</p>
                    </div>
                    <a href="admin-users.html" class="menu-item">
                        <span class="icon">ğŸ‘¥</span>
                        <span>íšŒì› ê´€ë¦¬</span>
                    </a>
                    <a href="admin-jobs.html" class="menu-item">
                        <span class="icon">ğŸ’¼</span>
                        <span>ì±„ìš©ê³µê³  ê´€ë¦¬</span>
                    </a>
                    <a href="admin-board.html" class="menu-item">
                        <span class="icon">ğŸ“‹</span>
                        <span>ê²Œì‹œíŒ ê´€ë¦¬</span>
                    </a>
                    <a href="admin-codes.html" class="menu-item">
                        <span class="icon">âš™ï¸</span>
                        <span>ì½”ë“œ ê´€ë¦¬</span>
                    </a>
                    <a href="admin-announcements.html" class="menu-item">
                        <span class="icon">ğŸ“¢</span>
                        <span>ê³µì§€ì‚¬í•­ ê´€ë¦¬</span>
                    </a>
                </div>
            </div>
        </aside>

        <main class="announcements-container" style="flex: 1; min-width: 0;">
        <div class="page-header">
            <h1>ğŸ¢ ì·¨ì—… ë°•ëŒíšŒ</h1>
            <p>ë‹¤ì–‘í•œ ê¸°ì—…ê³¼ì˜ ë§Œë‚¨ì˜ ê¸°íšŒë¥¼ ì°¾ì•„ë³´ì„¸ìš”</p>
        </div>

        <div class="filter-section">
            <select id="regionFilter">
                <option value="">ì „ì²´ ì§€ì—­</option>
                <option value="ì „ì£¼">ì „ì£¼</option>
                <option value="ì„œìš¸">ì„œìš¸</option>
                <option value="ê²½ê¸°">ê²½ê¸°</option>
                <option value="ë¶€ì‚°">ë¶€ì‚°</option>
                <option value="ëŒ€ì „">ëŒ€ì „</option>
                <option value="ì˜¨ë¼ì¸">ì˜¨ë¼ì¸</option>
            </select>
            
            <select id="statusFilter">
                <option value="">ì „ì²´</option>
                <option value="upcoming">ë‹¤ê°€ì˜¤ëŠ” ë°•ëŒíšŒ</option>
                <option value="available">ì‹ ì²­ ê°€ëŠ¥</option>
                <option value="past">ì§€ë‚œ ë°•ëŒíšŒ</option>
            </select>

            <input type="text" id="searchInput" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
        </div>

        <div id="announcementCount" class="announcement-count"></div>

        <div class="announcements-grid" id="announcementsGrid">
            <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë¨ -->
        </div>

        <div id="emptyState" class="empty-state" style="display: none;">
            <div class="empty-state-icon">ğŸ“‹</div>
            <h3>ë“±ë¡ëœ ì·¨ì—… ë°•ëŒíšŒê°€ ì—†ìŠµë‹ˆë‹¤</h3>
            <p>ìƒˆë¡œìš´ ë°•ëŒíšŒ ì •ë³´ê°€ ê³§ ì—…ë°ì´íŠ¸ë  ì˜ˆì •ì…ë‹ˆë‹¤.</p>
        </div>
    </main>
    </div>

    <!-- ìƒì„¸ë³´ê¸° ëª¨ë‹¬ -->
    <div id="detailModal" onclick="if(event.target===this)closeDetailModal()" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:1001; align-items:center; justify-content:center;">
        <div style="background:white; border-radius:16px; padding:2rem; width:92%; max-width:660px; max-height:90vh; overflow-y:auto; box-shadow:0 20px 60px rgba(0,0,0,0.35);">
            <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:1.5rem; border-bottom:2px solid #e2e8f0; padding-bottom:1rem;">
                <div style="flex:1; padding-right:1rem;">
                    <p id="detailOrganizer" style="color:#64748b; font-size:0.85rem; margin:0 0 0.4rem;"></p>
                    <h2 id="detailTitle" style="color:#1e3a8a; margin:0; font-size:1.2rem; line-height:1.4;"></h2>
                </div>
                <button onclick="closeDetailModal()" style="background:none; border:none; font-size:1.8rem; cursor:pointer; color:#94a3b8; line-height:1; flex-shrink:0;">&times;</button>
            </div>
            <div id="detailContent"></div>
        </div>
    </div>

    <!-- ì‹ ì²­ ëª¨ë‹¬ -->
    <div id="applyModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
        <div style="background:white; border-radius:12px; padding:2rem; width:90%; max-width:500px; max-height:90vh; overflow-y:auto; box-shadow:0 20px 60px rgba(0,0,0,0.3);">
            <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:1rem;">
                <h2 style="color:#1e3a8a; margin:0; font-size:1.3rem;">ğŸ“‹ ì‹ ì²­í•˜ê¸°</h2>
                <button onclick="closeApplyModal()" style="background:none; border:none; font-size:1.8rem; cursor:pointer; color:#64748b; line-height:1;">&times;</button>
            </div>
            <div id="applyModalInfo" style="background:#f0f4ff; padding:1rem; border-radius:8px; margin-bottom:1.5rem; font-size:0.9rem; color:#1e40af; font-weight:600;"></div>
            <form id="applyForm" onsubmit="submitApplication(event)">
                <input type="hidden" id="applyAnnouncementId">
                <div style="margin-bottom:1rem;">
                    <label style="display:block; font-weight:600; color:#374151; margin-bottom:0.4rem;">ì´ë¦„ <span style="color:#ef4444;">*</span></label>
                    <input type="text" id="applyName" required placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" style="width:100%; padding:0.75rem; border:1px solid #d1d5db; border-radius:8px; font-size:1rem; box-sizing:border-box;">
                </div>
                <div style="margin-bottom:1rem;">
                    <label style="display:block; font-weight:600; color:#374151; margin-bottom:0.4rem;">ì—°ë½ì²˜ <span style="color:#ef4444;">*</span></label>
                    <input type="tel" id="applyPhone" required placeholder="010-0000-0000" style="width:100%; padding:0.75rem; border:1px solid #d1d5db; border-radius:8px; font-size:1rem; box-sizing:border-box;">
                </div>
                <div style="margin-bottom:1rem;">
                    <label style="display:block; font-weight:600; color:#374151; margin-bottom:0.4rem;">ì´ë©”ì¼ <span style="color:#6b7280; font-weight:400;">(ì„ íƒ)</span></label>
                    <input type="email" id="applyEmail" placeholder="ì´ë©”ì¼ ì£¼ì†Œ" style="width:100%; padding:0.75rem; border:1px solid #d1d5db; border-radius:8px; font-size:1rem; box-sizing:border-box;">
                </div>
                <div style="margin-bottom:1.5rem;">
                    <label style="display:block; font-weight:600; color:#374151; margin-bottom:0.4rem;">ë¬¸ì˜ ë©”ì‹œì§€ <span style="color:#6b7280; font-weight:400;">(ì„ íƒ)</span></label>
                    <textarea id="applyMessage" placeholder="ì¶”ê°€ ë¬¸ì˜ ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”" rows="3" style="width:100%; padding:0.75rem; border:1px solid #d1d5db; border-radius:8px; font-size:1rem; box-sizing:border-box; resize:vertical;"></textarea>
                </div>
                <div style="display:flex; gap:1rem;">
                    <button type="button" onclick="closeApplyModal()" style="flex:1; padding:0.875rem; background:#f3f4f6; border:none; border-radius:8px; font-size:1rem; cursor:pointer; color:#374151; font-weight:600;">ì·¨ì†Œ</button>
                    <button type="submit" id="applySubmitBtn" style="flex:2; padding:0.875rem; background:#1e40af; color:white; border:none; border-radius:8px; font-size:1rem; cursor:pointer; font-weight:600;">ì‹ ì²­ í™•ì¸</button>
                </div>
            </form>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2026 ì „ë¶ì§€ì—­ ì¡¸ì—…ìƒ ë„¤íŠ¸ì›Œí¬. All rights reserved.</p>
        </div>
    </footer>

    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script>
        let announcements = [];

        // ===== ë””ë²„ê·¸ ì˜¤ë²„ë ˆì´ =====
        function dbg(msg) {
            let el = document.getElementById('__debugOverlay');
            if (!el) {
                el = document.createElement('div');
                el.id = '__debugOverlay';
                el.style.cssText = 'position:fixed;bottom:0;left:0;right:0;background:#1a1a2e;color:#0f0;font:12px monospace;padding:8px;z-index:99999;max-height:180px;overflow-y:auto;white-space:pre-wrap;border-top:2px solid #0f0;';
                document.body.appendChild(el);
            }
            el.textContent += new Date().toLocaleTimeString() + ' ' + msg + '\n';
        }
        window.addEventListener('error', e => dbg('ğŸ’¥ JSì˜¤ë¥˜: ' + e.message + ' @ ' + e.filename + ':' + e.lineno));

        // í˜ì´ì§€ ë¡œë“œ ì‹œ
        document.addEventListener('DOMContentLoaded', async () => {
            dbg('DOMContentLoaded - loadAnnouncements ì‹œì‘');
            await loadAnnouncements();
            setupFilters();
        });

        // API ê¸°ë³¸ URL (api.jsì˜ API_BASE_URL ì‚¬ìš© - ë¡œì»¬:5001, í”„ë¡œë•ì…˜:/api)
        const API_BASE = API_BASE_URL;

        // ì·¨ì—… ë°•ëŒíšŒ ëª©ë¡ ë¡œë“œ
        async function loadAnnouncements() {
            const grid = document.getElementById('announcementsGrid');
            const emptyState = document.getElementById('emptyState');
            const countEl = document.getElementById('announcementCount');
            if (countEl) countEl.textContent = 'ë¡œë”© ì¤‘...';
            dbg('fetch ì‹œë„: ' + API_BASE + '/announcements/job-fair');
            try {
                const res = await fetch(API_BASE + '/announcements/job-fair');
                dbg('ì‘ë‹µ ìƒíƒœ: ' + res.status + ' ok=' + res.ok);
                if (!res.ok) throw new Error('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: ' + res.status);
                const data = await res.json();
                announcements = data.announcements || [];
                dbg('ë°ì´í„° ìˆ˜ì‹ : ' + announcements.length + 'ê±´');
                if (announcements.length === 0) {
                    if (grid) grid.style.display = 'none';
                    if (emptyState) emptyState.style.display = 'block';
                    if (countEl) countEl.textContent = '';
                    dbg('âš ï¸ ê³µì§€ì‚¬í•­ 0ê±´ - emptyState í‘œì‹œ');
                } else {
                    if (emptyState) emptyState.style.display = 'none';
                    if (grid) grid.style.display = 'grid';
                    if (countEl) countEl.textContent = 'ì´ ' + announcements.length + 'ê°œì˜ ë°•ëŒíšŒ';
                    const html = announcements.map(function(item) {
                        try { return createAnnouncementCard(item); }
                        catch(e) { dbg('ì¹´ë“œ ì˜¤ë¥˜: ' + e.message); return ''; }
                    }).join('');
                    grid.innerHTML = html;
                    dbg('âœ… grid.innerHTML ì„¤ì •ì™„ë£Œ - grid display=' + (grid ? grid.style.display : 'N/A'));
                }
            } catch (error) {
                dbg('âŒ fetch ì˜¤ë¥˜: ' + error.message);
                console.error('ì·¨ì—… ë°•ëŒíšŒ ë¡œë“œ ì‹¤íŒ¨:', error);
                if (emptyState) {
                    emptyState.style.display = 'block';
                    var p = emptyState.querySelector('p');
                    if (p) p.textContent = 'ë°ì´í„° ë¡œë”© ì‹¤íŒ¨: ' + error.message;
                }
                if (countEl) countEl.textContent = '';
            }
        }

        // ë°•ëŒíšŒ ëª©ë¡ í‘œì‹œ
        function displayAnnouncements(items) {
            const grid = document.getElementById('announcementsGrid');
            const emptyState = document.getElementById('emptyState');
            const countEl = document.getElementById('announcementCount');

            if (items.length === 0) {
                grid.style.display = 'none';
                emptyState.style.display = 'block';
                countEl.textContent = '';
                return;
            }

            grid.style.display = 'grid';
            emptyState.style.display = 'none';
            countEl.textContent = `ì´ ${items.length}ê°œì˜ ë°•ëŒíšŒ`;

            grid.innerHTML = items.map(item => {
                try { return createAnnouncementCard(item); }
                catch(e) { console.error('ì¹´ë“œ ì˜¤ë¥˜:', e, item); return ''; }
            }).join('');
        }

        // ë°•ëŒíšŒ ì¹´ë“œ ìƒì„±
        function createAnnouncementCard(item) {
            const eventDate = item.event_date ? new Date(item.event_date).toLocaleDateString('ko-KR') : '-';
            const deadline = item.deadline ? new Date(item.deadline).toLocaleDateString('ko-KR') : '-';
            const progress = item.capacity ? Math.round((item.current_applicants / item.capacity) * 100) : 0;
            const tags = Array.isArray(item.tags) ? item.tags : [];
            const benefits = Array.isArray(item.benefits) ? item.benefits : [];

            return `
                <div class="announcement-card">
                    ${item.image_url ? `<img src="${item.image_url}" alt="${item.title}" class="announcement-image">` : '<div class="announcement-image"></div>'}
                    <div class="announcement-content">
                        <div class="announcement-header">
                            <h3 class="announcement-title">${item.title}</h3>
                            ${item.organizer ? `<p class="announcement-organizer">${item.organizer}</p>` : ''}
                        </div>

                        ${item.rating ? `
                        <div class="announcement-rating">
                            <span class="stars">${'â˜…'.repeat(Math.round(item.rating))}${'â˜†'.repeat(5 - Math.round(item.rating))}</span>
                            <span class="review-count">${item.rating} (${item.review_count || 0}ê°œ ë¦¬ë·°)</span>
                        </div>
                        ` : ''}

                        <div class="announcement-meta">
                            <div class="meta-item">
                                <span class="meta-icon">ğŸ“…</span>
                                <span>${eventDate}</span>
                            </div>
                            ${item.event_time ? `
                            <div class="meta-item">
                                <span class="meta-icon">ğŸ•</span>
                                <span>${item.event_time}</span>
                            </div>
                            ` : ''}
                            ${item.location ? `
                            <div class="meta-item">
                                <span class="meta-icon">ğŸ“</span>
                                <span>${item.location}</span>
                            </div>
                            ` : ''}
                            ${item.fee ? `
                            <div class="meta-item">
                                <span class="meta-icon">ğŸ’°</span>
                                <span>${item.fee}</span>
                            </div>
                            ` : ''}
                        </div>

                        ${tags.length > 0 ? `
                        <div class="announcement-tags">
                            ${tags.map(tag => `<span class="tag">#${tag}</span>`).join('')}
                        </div>
                        ` : ''}

                        ${benefits.length > 0 ? `
                        <div class="announcement-benefits" style="background: #f8fafc; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                            <strong style="color: #1e40af; display: block; margin-bottom: 0.5rem;">ì£¼ìš” í˜œíƒ</strong>
                            ${benefits.slice(0, 3).map(benefit => `<div style="font-size: 0.9rem; color: #475569; margin-bottom: 0.25rem;">âœ“ ${benefit}</div>`).join('')}
                        </div>
                        ` : ''}

                        <div class="announcement-actions" style="margin-top: 1rem;">
                            <button onclick="openDetailModal(${item.id})" class="btn btn-secondary">ìƒì„¸ë³´ê¸°</button>
                        </div>

                        ${deadline !== '-' ? `<p style="text-align: center; margin-top: 1rem; color: #ef4444; font-size: 0.9rem;">ë§ˆê°: ${deadline}</p>` : ''}
                    </div>
                </div>
            `;
        }

        // í•„í„° ì„¤ì •
        function setupFilters() {
            const regionFilter = document.getElementById('regionFilter');
            const statusFilter = document.getElementById('statusFilter');
            const searchInput = document.getElementById('searchInput');

            [regionFilter, statusFilter, searchInput].forEach(el => {
                el.addEventListener('change', applyFilters);
                el.addEventListener('input', applyFilters);
            });
        }

        // í•„í„° ì ìš©
        function applyFilters() {
            const region = document.getElementById('regionFilter').value.toLowerCase();
            const status = document.getElementById('statusFilter').value;
            const search = document.getElementById('searchInput').value.toLowerCase();

            let filtered = announcements;

            // ì§€ì—­ í•„í„°
            if (region) {
                filtered = filtered.filter(item => 
                    item.location && item.location.toLowerCase().includes(region)
                );
            }

            // ìƒíƒœ í•„í„°
            if (status) {
                const now = new Date();
                filtered = filtered.filter(item => {
                    const eventDate = new Date(item.event_date);
                    const deadlineDate = new Date(item.deadline);
                    
                    if (status === 'upcoming') return eventDate > now;
                    if (status === 'available') return deadlineDate > now;
                    if (status === 'past') return eventDate < now;
                    return true;
                });
            }

            // ê²€ìƒ‰ í•„í„°
            if (search) {
                filtered = filtered.filter(item =>
                    item.title.toLowerCase().includes(search) ||
                    (item.description && item.description.toLowerCase().includes(search)) ||
                    (item.organizer && item.organizer.toLowerCase().includes(search))
                );
            }

            displayAnnouncements(filtered);
        }

        // ì‹ ì²­ ëª¨ë‹¬ ì—´ê¸°
        function openApplyModal(id, title) {
            const user = auth.getCurrentUser();
            if (!user) {
                window.location.href = 'login.html?returnUrl=' + encodeURIComponent(window.location.pathname);
                return;
            }
            document.getElementById('applyAnnouncementId').value = id;
            document.getElementById('applyModalInfo').textContent = title;
            document.getElementById('applyName').value = user.name || '';
            document.getElementById('applyPhone').value = user.phone || '';
            document.getElementById('applyEmail').value = user.email || '';
            document.getElementById('applyMessage').value = '';
            document.getElementById('applyModal').style.display = 'flex';
        }

        function closeApplyModal() {
            document.getElementById('applyModal').style.display = 'none';
        }

        // ì‹ ì²­ ì œì¶œ
        async function submitApplication(e) {
            e.preventDefault();
            const btn = document.getElementById('applySubmitBtn');
            btn.textContent = 'ì²˜ë¦¬ ì¤‘...';
            btn.disabled = true;
            try {
                await api.post('/announcements/apply', {
                    announcement_id: parseInt(document.getElementById('applyAnnouncementId').value),
                    applicant_name: document.getElementById('applyName').value.trim(),
                    applicant_phone: document.getElementById('applyPhone').value.trim(),
                    applicant_email: document.getElementById('applyEmail').value.trim(),
                    message: document.getElementById('applyMessage').value.trim()
                });
                closeApplyModal();
                alert('âœ… ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                loadAnnouncements();
            } catch (error) {
                alert('âŒ ' + (error.message || 'ì‹ ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'));
            } finally {
                btn.textContent = 'ì‹ ì²­ í™•ì¸';
                btn.disabled = false;
            }
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.getElementById('applyModal').addEventListener('click', function(e) {
            if (e.target === this) closeApplyModal();
        });

        // ìƒì„¸ë³´ê¸° ëª¨ë‹¬
        function openDetailModal(id) {
            const item = announcements.find(a => a.id === id);
            if (!item) return;
            const eventDate = item.event_date ? new Date(item.event_date).toLocaleDateString('ko-KR') : '-';
            const deadline = item.deadline ? new Date(item.deadline).toLocaleDateString('ko-KR') : '-';
            const benefits = Array.isArray(item.benefits) ? item.benefits : [];
            const requirements = Array.isArray(item.requirements) ? item.requirements : [];
            const tags = Array.isArray(item.tags) ? item.tags : [];
            document.getElementById('detailTitle').textContent = item.title;
            document.getElementById('detailOrganizer').textContent = item.organizer || '';
            document.getElementById('detailContent').innerHTML = `
                ${item.description ? `<p style="color:#374151; font-size:0.95rem; line-height:1.7; margin:0 0 1.5rem; padding:1rem; background:#f8fafc; border-radius:8px; border-left:3px solid #3b82f6;">${item.description}</p>` : ''}
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:1rem; margin-bottom:1.5rem;">
                    <div style="background:#f0f4ff; padding:0.9rem; border-radius:8px;">
                        <div style="font-size:0.75rem; color:#6b7280; margin-bottom:0.25rem;">ğŸ“… í–‰ì‚¬ ë‚ ì§œ</div>
                        <div style="font-weight:600; color:#1e3a8a;">${eventDate}${item.event_time ? ' ' + item.event_time : ''}</div>
                    </div>
                    <div style="background:#f0f4ff; padding:0.9rem; border-radius:8px;">
                        <div style="font-size:0.75rem; color:#6b7280; margin-bottom:0.25rem;">â° ì‹ ì²­ ë§ˆê°</div>
                        <div style="font-weight:600; color:#ef4444;">${deadline}</div>
                    </div>
                    ${item.location ? `<div style="background:#f0fdf4; padding:0.9rem; border-radius:8px;">
                        <div style="font-size:0.75rem; color:#6b7280; margin-bottom:0.25rem;">ğŸ“ ì¥ì†Œ</div>
                        <div style="font-weight:600; color:#166534;">${item.location}</div>
                    </div>` : ''}
                    ${item.fee ? `<div style="background:#fefce8; padding:0.9rem; border-radius:8px;">
                        <div style="font-size:0.75rem; color:#6b7280; margin-bottom:0.25rem;">ğŸ’° ì°¸ê°€ë¹„</div>
                        <div style="font-weight:600; color:#854d0e;">${item.fee}</div>
                    </div>` : ''}
                </div>
                ${item.rating ? `<div style="display:flex; align-items:center; gap:0.5rem; margin-bottom:1.5rem;">
                    <span style="color:#f59e0b; font-size:1.1rem;">${'â˜…'.repeat(Math.round(Number(item.rating)))}${'â˜†'.repeat(5-Math.round(Number(item.rating)))}</span>
                    <span style="color:#64748b; font-size:0.9rem;">${item.rating} (${item.review_count || 0}ê°œ ë¦¬ë·°)</span>
                </div>` : ''}
                ${benefits.length > 0 ? `<div style="margin-bottom:1.25rem;">
                    <strong style="color:#1e40af; display:block; margin-bottom:0.6rem; font-size:0.95rem;">âœ… ì£¼ìš” í˜œíƒ</strong>
                    ${benefits.map(b => `<div style="font-size:0.9rem; color:#374151; padding:0.3rem 0; border-bottom:1px solid #f1f5f9;">â€¢ ${b}</div>`).join('')}
                </div>` : ''}
                ${requirements.length > 0 ? `<div style="margin-bottom:1.25rem;">
                    <strong style="color:#1e40af; display:block; margin-bottom:0.6rem; font-size:0.95rem;">ğŸ“‹ ì‹ ì²­ ìê²©</strong>
                    ${requirements.map(r => `<div style="font-size:0.9rem; color:#374151; padding:0.3rem 0; border-bottom:1px solid #f1f5f9;">â€¢ ${r}</div>`).join('')}
                </div>` : ''}
                ${(item.contact_phone || item.contact_email) ? `<div style="background:#f8fafc; padding:1rem; border-radius:8px; margin-bottom:1rem;">
                    <strong style="color:#374151; display:block; margin-bottom:0.5rem; font-size:0.9rem;">ğŸ“ ë¬¸ì˜</strong>
                    ${item.contact_phone ? `<div style="font-size:0.9rem; color:#475569; margin-bottom:0.25rem;">â˜ ${item.contact_phone}</div>` : ''}
                    ${item.contact_email ? `<div style="font-size:0.9rem; color:#475569;">âœ‰ ${item.contact_email}</div>` : ''}
                </div>` : ''}
                ${tags.length > 0 ? `<div style="display:flex; flex-wrap:wrap; gap:0.4rem; margin-top:0.5rem;">
                    ${tags.map(t => `<span style="background:#dbeafe; color:#1e40af; padding:0.25rem 0.6rem; border-radius:999px; font-size:0.8rem;">#${t}</span>`).join('')}
                </div>` : ''}
            `;
            document.getElementById('detailModal').style.display = 'flex';
        }
        function closeDetailModal() {
            document.getElementById('detailModal').style.display = 'none';
        }
    </script>
</body>
</html>
