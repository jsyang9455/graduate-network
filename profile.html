<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚´ í”„ë¡œí•„ - ì „ì£¼ê³µì—…ê³ ë“±í•™êµ ì¡¸ì—…ìƒ ë„¤íŠ¸ì›Œí¬</title>
    <link rel="icon" type="image/png" href="images/favicon.png">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/dashboard.css">
</head>
<body>
    <header id="mainHeader">
        <nav>
            <div class="logo">
                <img src="images/logo.png" alt="JJOBB" style="height: 40px;">
            </div>
            <ul class="nav-links">
                <li><a href="dashboard.html">ëŒ€ì‹œë³´ë“œ</a></li>
                <li><a href="jobs.html">ì±„ìš© ì •ë³´</a></li>
                <li><a href="networking.html">ë™ë¬¸ ë„¤íŠ¸ì›Œí‚¹</a></li>
                <li><a href="counseling.html">ì§„ë¡œ ìƒë‹´</a></li>
            </ul>
            <div class="user-menu">
                <span class="user-name" id="userName"></span>
                <button onclick="auth.logout()" class="btn-logout">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </nav>
    </header>

    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="sidebar-menu">
                <a href="dashboard.html" class="menu-item">
                    <span class="icon">ğŸ“Š</span>
                    <span>ëŒ€ì‹œë³´ë“œ</span>
                </a>
                <a href="profile.html" class="menu-item active">
                    <span class="icon">ğŸ‘¤</span>
                    <span>ë‚´ í”„ë¡œí•„</span>
                </a>
                <a href="jobs.html" class="menu-item">
                    <span class="icon">ğŸ’¼</span>
                    <span>ì±„ìš© ì •ë³´</span>
                </a>
                <a href="networking.html" class="menu-item">
                    <span class="icon">ğŸ¤</span>
                    <span>ë™ë¬¸ ë„¤íŠ¸ì›Œí‚¹</span>
                </a>
                <a href="counseling.html" class="menu-item" id="counselingMenu">
                    <span class="icon">ğŸ’¬</span>
                    <span>ì§„ë¡œ ìƒë‹´</span>
                </a>
                <a href="career.html" class="menu-item" id="careerMenu">
                    <span class="icon">ğŸ“ˆ</span>
                    <span>ê²½ë ¥ ê´€ë¦¬</span>
                </a>
            </div>
        </aside>

        <main class="main-content">
            <div class="profile-container">
                <h1>í”„ë¡œí•„ ê´€ë¦¬</h1>
                <div id="profileContent">
                    <!-- Student/Graduate Profile -->
                    <div id="studentProfile" style="display: none;">
                        <div class="profile-section">
                            <div class="profile-header">
                                <div class="profile-avatar">
                                    <span id="profileInitial">?</span>
                                </div>
                                <div class="profile-info">
                                    <h2 id="profileName">ì´ë¦„</h2>
                                    <p id="profileEmail">ì´ë©”ì¼</p>
                                    <p id="profileType">ì‚¬ìš©ì ìœ í˜•</p>
                                </div>
                                <button class="btn btn-primary" onclick="editProfile()">í”„ë¡œí•„ ìˆ˜ì •</button>
                            </div>
                        </div>

                        <div class="profile-section">
                            <h3>ğŸ“š í•™ì  ì •ë³´</h3>
                            <div class="info-grid">
                                <div class="info-item">
                                    <label>í•™êµ</label>
                                    <p id="profileSchool">-</p>
                                </div>
                                <div class="info-item">
                                    <label>í•™ë²ˆ</label>
                                    <p id="profileStudentId">-</p>
                                </div>
                                <div class="info-item">
                                    <label>ì „ê³µ</label>
                                    <p id="profileMajor">-</p>
                                </div>
                                <div class="info-item">
                                    <label>ì¡¸ì—…ë…„ë„</label>
                                    <p id="profileGradYear">-</p>
                                </div>
                            </div>
                        </div>

                        <div class="profile-section">
                            <h3>ğŸ“ ì—°ë½ì²˜ ì •ë³´</h3>
                            <div class="info-grid">
                                <div class="info-item">
                                    <label>ì „í™”ë²ˆí˜¸</label>
                                    <p id="profilePhone">-</p>
                                </div>
                                <div class="info-item">
                                    <label>ì´ë©”ì¼</label>
                                    <p id="profileEmailDetail">-</p>
                                </div>
                            </div>
                        </div>

                        <div class="profile-section">
                            <h3>ğŸ’¼ í™œë™ í†µê³„</h3>
                            <div class="stats-grid">
                                <div class="stat-card-small">
                                    <div class="stat-number" id="statApplications">0</div>
                                    <div class="stat-label">ì§€ì› í˜„í™©</div>
                                </div>
                                <div class="stat-card-small">
                                    <div class="stat-number" id="statConnections">0</div>
                                    <div class="stat-label">ë„¤íŠ¸ì›Œí¬</div>
                                </div>
                                <div class="stat-card-small">
                                    <div class="stat-number" id="statMessages">0</div>
                                    <div class="stat-label">ë©”ì‹œì§€</div>
                                </div>
                                <div class="stat-card-small">
                                    <div class="stat-number" id="statCounseling">0</div>
                                    <div class="stat-label">ìƒë‹´ ê¸°ë¡</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Teacher Profile -->
                    <div id="teacherProfile" style="display: none;">
                        <div class="profile-section">
                            <div class="profile-header">
                                <div class="profile-avatar">
                                    <span id="teacherInitial">?</span>
                                </div>
                                <div class="profile-info">
                                    <h2 id="teacherName">ì„ ìƒë‹˜ ì´ë¦„</h2>
                                    <p id="teacherEmail">ì´ë©”ì¼</p>
                                    <p>ğŸ« êµì‚¬</p>
                                </div>
                                <button class="btn btn-primary" onclick="editProfile()">í”„ë¡œí•„ ìˆ˜ì •</button>
                            </div>
                        </div>

                        <div class="profile-section">
                            <h3>ğŸ« ê·¼ë¬´ ì •ë³´</h3>
                            <div class="info-grid">
                                <div class="info-item">
                                    <label>ì†Œì† í•™êµ</label>
                                    <p id="teacherSchool">-</p>
                                </div>
                                <div class="info-item">
                                    <label>ë‹´ë‹¹ ê³¼ëª©</label>
                                    <p id="teacherSubject">ì „ì²´</p>
                                </div>
                            </div>
                        </div>

                        <div class="profile-section">
                            <h3>ğŸ“ ì—°ë½ì²˜ ì •ë³´</h3>
                            <div class="info-grid">
                                <div class="info-item">
                                    <label>ì´ë©”ì¼</label>
                                    <p id="teacherEmailDetail">-</p>
                                </div>
                                <div class="info-item">
                                    <label>ì „í™”ë²ˆí˜¸</label>
                                    <p id="teacherPhone">-</p>
                                </div>
                            </div>
                        </div>

                        <div class="profile-section">
                            <h3>ğŸ“Š í™œë™ í†µê³„</h3>
                            <div class="stats-grid">
                                <div class="stat-card-small">
                                    <div class="stat-number" id="statCounselingRequests">0</div>
                                    <div class="stat-label">ìƒë‹´ ìš”ì²­</div>
                                </div>
                                <div class="stat-card-small">
                                    <div class="stat-number" id="statStudents">0</div>
                                    <div class="stat-label">ìƒë‹´ í•™ìƒ</div>
                                </div>
                                <div class="stat-card-small">
                                    <div class="stat-number" id="statTeacherMessages">0</div>
                                    <div class="stat-label">ë©”ì‹œì§€</div>
                                </div>
                                <div class="stat-card-small">
                                    <div class="stat-number" id="statTeacherNetwork">0</div>
                                    <div class="stat-label">ë„¤íŠ¸ì›Œí¬</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- í”„ë¡œí•„ ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="editProfileModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>í”„ë¡œí•„ ìˆ˜ì •</h2>
                <span class="close" onclick="closeEditModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="editProfileForm">
                    <div class="form-group">
                        <label>ì´ë¦„</label>
                        <input type="text" id="editName" required>
                    </div>
                    <div class="form-group">
                        <label>ì´ë©”ì¼</label>
                        <input type="email" id="editEmail" required>
                    </div>
                    <div class="form-group">
                        <label>ì „í™”ë²ˆí˜¸</label>
                        <input type="tel" id="editPhone">
                    </div>
                    
                    <!-- Student/Graduate Fields -->
                    <div id="editStudentFields" style="display: none;">
                        <div class="form-group">
                            <label>í•™êµ</label>
                            <input type="text" id="editSchool">
                        </div>
                        <div class="form-group">
                            <label>í•™ë²ˆ</label>
                            <input type="text" id="editStudentId">
                        </div>
                        <div class="form-group">
                            <label>ì „ê³µ</label>
                            <input type="text" id="editMajor">
                        </div>
                        <div class="form-group">
                            <label>ì¡¸ì—…ë…„ë„</label>
                            <input type="text" id="editGradYear">
                        </div>
                        <div class="form-group">
                            <label>ì£¼ì†Œ</label>
                            <input type="text" id="editStudentAddress">
                        </div>
                    </div>

                    <!-- Teacher Fields -->
                    <div id="editTeacherFields" style="display: none;">
                        <div class="form-group">
                            <label>ì†Œì† í•™êµ</label>
                            <input type="text" id="editTeacherSchool">
                        </div>
                        <div class="form-group">
                            <label>ë‹´ë‹¹ ê³¼ëª©</label>
                            <input type="text" id="editSubject">
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">ì €ì¥</button>
                        <button type="button" onclick="closeEditModal()" class="btn btn-secondary">ì·¨ì†Œ</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script>
        // Profile page functionality
        document.addEventListener('DOMContentLoaded', function() {
            if (!auth.requireAuth()) {
                return;
            }

            const user = auth.getCurrentUser();
            console.log('Profile page - Current user:', user);

            if (user.user_type === 'teacher') {
                // Hide career menu for teacher
                const careerMenu = document.getElementById('careerMenu');
                if (careerMenu) careerMenu.style.display = 'none';
                
                showTeacherProfile(user);
            } else {
                showStudentProfile(user);
            }
        });

        function showStudentProfile(user) {
            const studentProfile = document.getElementById('studentProfile');
            const teacherProfile = document.getElementById('teacherProfile');
            
            if (studentProfile) studentProfile.style.display = 'block';
            if (teacherProfile) teacherProfile.style.display = 'none';

            // Basic info
            const initial = user.name ? user.name.charAt(0) : '?';
            document.getElementById('profileInitial').textContent = initial;
            document.getElementById('profileName').textContent = user.name || 'ì´ë¦„ ì—†ìŒ';
            document.getElementById('profileEmail').textContent = user.email || '';
            
            const userTypeText = user.user_type === 'student' ? 'ì¬í•™ìƒ' : 
                                 user.user_type === 'graduate' ? 'ì¡¸ì—…ìƒ' : 'ì‚¬ìš©ì';
            document.getElementById('profileType').textContent = `ğŸ“š ${userTypeText}`;

            // Academic info
            document.getElementById('profileSchool').textContent = user.schoolName || 'ì „ì£¼ê³µì—…ê³ ë“±í•™êµ';
            document.getElementById('profileStudentId').textContent = user.studentId || '-';
            document.getElementById('profileMajor').textContent = user.major || '-';
            document.getElementById('profileGradYear').textContent = user.graduationYear || '-';

            // Contact info
            document.getElementById('profilePhone').textContent = user.phone || '-';
            document.getElementById('profileEmailDetail').textContent = user.email || '-';

            // Stats
            const messages = JSON.parse(localStorage.getItem('graduateNetwork_messages') || '[]');
            const myMessages = messages.filter(m => String(m.toUserId) === String(user.id));
            document.getElementById('statMessages').textContent = myMessages.length;

            const connections = JSON.parse(localStorage.getItem('graduateNetwork_connections') || '[]');
            const myConnections = connections.filter(c => 
                c.userId === user.id || c.connectedUserId === user.id
            );
            document.getElementById('statConnections').textContent = myConnections.length;

            document.getElementById('statApplications').textContent = Math.floor(Math.random() * 5);
            document.getElementById('statCounseling').textContent = Math.floor(Math.random() * 3);
        }

        function showTeacherProfile(user) {
            const studentProfile = document.getElementById('studentProfile');
            const teacherProfile = document.getElementById('teacherProfile');
            
            if (studentProfile) studentProfile.style.display = 'none';
            if (teacherProfile) teacherProfile.style.display = 'block';

            // Basic info
            const initial = user.name ? user.name.charAt(0) : '?';
            document.getElementById('teacherInitial').textContent = initial;
            document.getElementById('teacherName').textContent = user.name || 'ì´ë¦„ ì—†ìŒ';
            document.getElementById('teacherEmail').textContent = user.email || '';

            // School info
            document.getElementById('teacherSchool').textContent = user.schoolName || 'ì „ì£¼ê³µì—…ê³ ë“±í•™êµ';
            document.getElementById('teacherSubject').textContent = user.subject || 'ì „ì²´';

            // Contact info
            document.getElementById('teacherEmailDetail').textContent = user.email || '-';
            document.getElementById('teacherPhone').textContent = user.phone || '-';

            // Stats
            const messages = JSON.parse(localStorage.getItem('graduateNetwork_messages') || '[]');
            const myMessages = messages.filter(m => String(m.toUserId) === String(user.id));
            document.getElementById('statTeacherMessages').textContent = myMessages.length;

            const connections = JSON.parse(localStorage.getItem('graduateNetwork_connections') || '[]');
            const myConnections = connections.filter(c => 
                c.userId === user.id || c.connectedUserId === user.id
            );
            document.getElementById('statTeacherNetwork').textContent = myConnections.length;

            document.getElementById('statCounselingRequests').textContent = Math.floor(Math.random() * 10 + 5);
            document.getElementById('statStudents').textContent = Math.floor(Math.random() * 20 + 10);
        }

        function editProfile() {
            const user = auth.getCurrentUser();
            if (!user) return;

            // Open modal
            document.getElementById('editProfileModal').style.display = 'block';

            // Fill form with current data
            document.getElementById('editName').value = user.name || '';
            document.getElementById('editEmail').value = user.email || '';
            document.getElementById('editPhone').value = user.phone || '';

            // Show/hide fields based on user type
            if (user.user_type === 'student' || user.user_type === 'graduate') {
                document.getElementById('editStudentFields').style.display = 'block';
                document.getElementById('editTeacherFields').style.display = 'none';
                
                document.getElementById('editSchool').value = user.school || '';
                document.getElementById('editStudentId').value = user.studentId || '';
                document.getElementById('editMajor').value = user.major || '';
                document.getElementById('editGradYear').value = user.graduationYear || '';
                document.getElementById('editStudentAddress').value = user.address || '';
            } else if (user.user_type === 'teacher') {
                document.getElementById('editStudentFields').style.display = 'none';
                document.getElementById('editTeacherFields').style.display = 'block';
                
                document.getElementById('editTeacherSchool').value = user.school || '';
                document.getElementById('editSubject').value = user.subject || '';
            }
        }

        function closeEditModal() {
            document.getElementById('editProfileModal').style.display = 'none';
        }

        // Setup form submission
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('editProfileForm');
            if (form) {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveProfile();
                });
            }
        });

        function saveProfile() {
            const user = auth.getCurrentUser();
            if (!user) return;

            // Get all users
            const users = JSON.parse(localStorage.getItem('graduateNetwork_users') || '[]');
            const userIndex = users.findIndex(u => String(u.id) === String(user.id));
            
            if (userIndex === -1) {
                alert('ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // Update basic info
            users[userIndex].name = document.getElementById('editName').value;
            users[userIndex].email = document.getElementById('editEmail').value;
            users[userIndex].phone = document.getElementById('editPhone').value;

            // Update type-specific fields
            if (user.user_type === 'student' || user.user_type === 'graduate') {
                users[userIndex].school = document.getElementById('editSchool').value;
                users[userIndex].studentId = document.getElementById('editStudentId').value;
                users[userIndex].major = document.getElementById('editMajor').value;
                users[userIndex].graduationYear = document.getElementById('editGradYear').value;
                users[userIndex].address = document.getElementById('editStudentAddress').value;
            } else if (user.user_type === 'teacher') {
                users[userIndex].school = document.getElementById('editTeacherSchool').value;
                users[userIndex].subject = document.getElementById('editSubject').value;
            }

            // Save to localStorage
            localStorage.setItem('graduateNetwork_users', JSON.stringify(users));
            
            // Update current user in session
            localStorage.setItem('graduateNetwork_user', JSON.stringify(users[userIndex]));

            // Close modal and reload profile
            closeEditModal();
            alert('í”„ë¡œí•„ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
            location.reload();
        }
    </script>
</body>
</html>
